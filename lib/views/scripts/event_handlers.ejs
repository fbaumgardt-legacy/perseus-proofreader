<script type="text/javascript">
    var changeBtn = function(jq, text) {
        jq.group = jq.elem.closest(".btn-group").first();
        jq.toggle = jq.group.find(".dropdown-toggle").first().removeClass("btn-danger btn-warning btn-info").addClass("btn-success");
        jq.btn = jq.group.find(".alt").first().removeClass("btn-danger btn-warning btn-info").addClass("btn-success");

        json.index[jq.group.first().attr("id")].children[0].children  = [{tag:"ins",text:text,attributes:{title:"nlp 2.00"}}];
        jq.btn.text(text);
    }
    // Event handlers
    $('.dropdown-menu input').click(function(e){
        e.stopPropagation();
    }).keypress(function(e) { if (e.keyCode == 13) {
                $('.btn-group.open .dropdown-toggle').dropdown('toggle');
                changeBtn({elem: $(e.target)}, $(e.target)[0].value)
                return false;
            }});
    $('li > a').click(function (e) {
        $('.btn-group.open .dropdown-toggle').dropdown('toggle');
        changeBtn({elem: $(e.target)}, $(e.target).text())
        return false;
    });

    // Event handlers
    $('.form-control').keypress(function(e) {
        var ip = $('.modal-body .form-control')
        var validated = ip.eq(0).prop('textLength')>0 && ip.eq(1).prop('textLength')>0 && ip.eq(2).prop('textLength')>0
        if (validated) {
            $('#btn-commit').prop('disabled', false);
        } else {
            $('#btn-commit').prop('disabled', true);
        }
    });

    $('#btn-commit').click(function(e) {
        $.post('',json.doc.html,function(){
            $('#btn-commit').prop('disabled', true);
            $('.modal-body').innerHTML;
        });
    });
    $('#btn-commit').click(function (e) {
        // create object from json + input fields
        var ip = $('.modal-body .form-control')
        var req = {name: ip.eq(0).val(), email: ip.eq(1).val(), msg: ip.eq(2).val(), dat: json.doc.html}
        // post object to commit url
        $.post('',req,function(){
            // give feedback message
            $('#btn-commit').prop('disabled', true);
            $('.modal-body').html('Success');
        });
    });
</script>